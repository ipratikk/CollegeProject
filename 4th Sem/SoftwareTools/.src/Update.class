' Gambas class file

Private Val As String
Public Sub Button1_Click()
  Dim tmp As Integer
  Dim tmp2 As Float
  If product.Text = "" Or qty.Text = "" Or Rate.Text = "" Then
    Message.Info("Invalid Entry", "OK")
  Else
    Val = product.Text
    tmp = Check()
    If tmp == -1 Then
      Main.Quantity[Main.Top] = Val(qty.Text)
      Main.Rate[Main.Top] = Val(Rate.Text)
    Else
      Main.Quantity[tmp] + = Val(qty.Text)
      tmp2 = ((Main.Rate[tmp] * (Main.Quantity[tmp] - Val(Rate.Text))) + (Val(Rate.Text) * Val(qty.Text))) / (Main.Quantity[tmp])
      Main.Rate[tmp] = tmp2
    Endif
    ProductsList.Add(Main.Top, product.Text)
    ProductsList[Main.Top][1] = qty.Text
    ProductsList[Main.Top][2] = Rate.Text
    Inc Main.Top
  Endif

End
Public Sub Check() As Integer
  
  Dim i, ind As Integer
  ind = -1
  For i = 0 To Main.Top Step 1
  If Main.Material[i] == Val Then
    ind = i
    Break
  Endif
  Next
  Return ind
End

Public Sub Form_Open()

  init()
  ProductsList.Columns.Count = 3
  ProductsList.Header = 1 'show header 
  ProductsList.Mode = Select.Single
  ProductsList.Columns[0].Text = "Product" 
  ProductsList.Columns[1].Text = "Quantity"
  ProductsList.Columns[2].Text = "Rate" 

End
Public Sub init()
  
  For i As Integer = 0 To 10
    qty.Add(Str(i))
  Next
  
End
